_pkgname=RDKit

pkgname=(rdkit-python rdkit-python2)
pkgver=2016_09_1
pkgrel=1
pkgdesc="RDKit - A collection of cheminformatics and machine-learning software written in C++ and Python."
arch=("i686" "x86_64")
url="http://rdkit.org/"
license=('New BSD License')
depends=( 'bison' 'boost' 'boost-libs=1.62.0-2' 'cmake' 'flex' 'python' 'python-numpy' 'sqlite3' )
source=(https://github.com/rdkit/rdkit/archive/Release_${pkgver}.tar.gz)
sha256sums=('a9bd932d12795173335ba70e6fe73afaa46c37e9e738ae034e0833c656be6431')
provides=('rdkit-python')

build() {
    mkdir $srcdir/{build-python,build-python2}
    cd $srcdir/build-python
    cmake ../rdkit-Release_${pkgver} \
        -DCMAKE_BUILD_TYPE=Release \
        -DRDK_INSTALL_INTREE=0 \
        -DCMAKE_INSTALL_PREFIX=/opt/rdkit-python \
        -DPYTHON_LIBRARY=/usr/lib/python3.5/config-3.5m/libpython3.5m.so \
        -DPYTHON_INCLUDE_DIR=/usr/include/python3.5m/ \
        -DPYTHON_EXECUTABLE=/usr/bin/python3 \
        -DCMAKE_INSTALL_RPATH=/opt/rdkit-python/lib
    make

    cd $srcdir/build-python2
    cmake ../rdkit-Release_${pkgver} \
        -DCMAKE_BUILD_TYPE=Release \
        -DRDK_INSTALL_INTREE=0 \
        -DCMAKE_INSTALL_PREFIX=/opt/rdkit-python2 \
        -DPYTHON_LIBRARY=/usr/lib/python2.7/config/libpython2.7.so \
        -DPYTHON_INCLUDE_DIR=/usr/include/python2.7/ \
        -DPYTHON_EXECUTABLE=/usr/bin/python2 \
        -DCMAKE_INSTALL_RPATH=/opt/rdkit-python2/lib
    make
}

package_rdkit-python() {
  cd ${srcdir}/build-python
  make DESTDIR=${pkgdir} install 
  mkdir -p $pkgdir/usr/lib/python3.5/site-packages
  echo /opt/rdkit-python/lib/python3.5/site-packages > $pkgdir/usr/lib/python3.5/site-packages/rdkit.pth
}

package_rdkit-python2() {
    cd ${srcdir}/build-python2
    make DESTDIR=${pkgdir} install
    mkdir -p $pkgdir/usr/lib/python2.7/site-packages
    echo /opt/rdkit-python2/lib/python2.7/site-packages > $pkgdir/usr/lib/python2.7/site-packages/rdkit.pth
}
